c6677aa6ad65d9a37fc6e54ebc172717
"use strict";
/**
 * Security Validator - Input Validation and Security Hardening
 * Implements comprehensive security measures for neural agent system
 *
 * Security Features:
 * - Input validation and sanitization
 * - SQL injection prevention
 * - Neural weight integrity validation
 * - Rate limiting and DDoS protection
 * - Audit logging and monitoring
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.SecurityValidator = void 0;
const crypto = __importStar(require("crypto"));
class SecurityValidator {
    constructor(config = {}) {
        Object.defineProperty(this, "config", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "requestCounts", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: new Map()
        });
        Object.defineProperty(this, "auditLogs", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: []
        });
        Object.defineProperty(this, "encryptionKey", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        this.config = {
            enableInputValidation: true,
            enableRateLimiting: true,
            enableAuditLogging: true,
            maxInputSize: 1024 * 1024, // 1MB
            rateLimitWindow: 60, // 1 minute
            rateLimitMaxRequests: 100,
            ...config
        };
        // Initialize encryption key
        this.encryptionKey = this.config.encryptionKey
            ? Buffer.from(this.config.encryptionKey, 'hex')
            : crypto.randomBytes(32);
    }
    /**
     * Validate and sanitize SQL query parameters
     * Prevents SQL injection attacks
     */
    validateSQLParameters(query, params) {
        const errors = [];
        let securityScore = 100;
        // Check for SQL injection patterns
        const sqlInjectionPatterns = [
            /(\b(SELECT|INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|EXEC|UNION)\b)/i,
            /('|(--|\/\*|\*\/|;))/,
            /((\%27)|(\')|(--)|(\%23)|(#))/i,
            /((\%3D)|(=))[^\n]*((\%27)|(\')|(--)|(\%3B)|(;))/i,
            /\w*((\%27)|(\'))((\%6F)|o|(\%4F))((\%72)|r|(\%52))/i
        ];
        for (const param of params) {
            if (typeof param === 'string') {
                for (const pattern of sqlInjectionPatterns) {
                    if (pattern.test(param)) {
                        errors.push(`Potential SQL injection detected in parameter: ${param.substring(0, 50)}...`);
                        securityScore -= 20;
                    }
                }
                // Check for excessive length
                if (param.length > this.config.maxInputSize) {
                    errors.push(`Parameter exceeds maximum length: ${param.length}`);
                    securityScore -= 10;
                }
            }
        }
        // Sanitize parameters
        const sanitizedParams = params.map(param => {
            if (typeof param === 'string') {
                return param
                    .replace(/['"]/g, '') // Remove quotes
                    .replace(/[-;]/g, '') // Remove dangerous characters
                    .substring(0, this.config.maxInputSize); // Truncate
            }
            return param;
        });
        this.auditLog('sql_validation', {
            query: query.substring(0, 100),
            paramCount: params.length,
            securityScore,
            errors: errors.length
        }, errors.length > 0 ? 'high' : 'low');
        return {
            isValid: errors.length === 0,
            errors,
            sanitizedInput: sanitizedParams,
            securityScore
        };
    }
    /**
     * Validate neural network input data
     * Prevents malicious neural inputs
     */
    validateNeuralInput(inputs) {
        const errors = [];
        let securityScore = 100;
        // Check input size
        if (inputs.length > 10000) {
            errors.push(`Neural input too large: ${inputs.length} elements`);
            securityScore -= 30;
        }
        // Check for NaN or Infinity values
        const invalidValues = Array.from(inputs).filter(val => !isFinite(val));
        if (invalidValues.length > 0) {
            errors.push(`Invalid values detected: ${invalidValues.length} NaN/Infinity values`);
            securityScore -= 20;
        }
        // Check for extreme values that could cause overflow
        const extremeValues = Array.from(inputs).filter(val => Math.abs(val) > 1000);
        if (extremeValues.length > 0) {
            errors.push(`Extreme values detected: ${extremeValues.length} values > 1000`);
            securityScore -= 10;
        }
        // Sanitize inputs
        const sanitizedInputs = Array.from(inputs).map(val => {
            if (!isFinite(val))
                return 0;
            return Math.max(-1000, Math.min(1000, val)); // Clamp to safe range
        });
        this.auditLog('neural_input_validation', {
            inputSize: inputs.length,
            invalidValues: invalidValues.length,
            extremeValues: extremeValues.length,
            securityScore
        }, extremeValues.length > 0 ? 'medium' : 'low');
        return {
            isValid: errors.length === 0,
            errors,
            sanitizedInput: new Float32Array(sanitizedInputs),
            securityScore
        };
    }
    /**
     * Validate neural weight integrity with checksums
     * Prevents weight tampering
     */
    validateNeuralWeights(weights, expectedChecksum) {
        const errors = [];
        let securityScore = 100;
        // Calculate actual checksum
        const actualChecksum = crypto.createHash('sha256').update(weights).digest('hex');
        // Verify integrity
        if (actualChecksum !== expectedChecksum) {
            errors.push('Neural weight integrity check failed - data may be corrupted or tampered');
            securityScore = 0;
        }
        // Check weight size
        if (weights.length > 100 * 1024 * 1024) { // 100MB limit
            errors.push(`Neural weights too large: ${weights.length} bytes`);
            securityScore -= 20;
        }
        // Check for patterns that might indicate malicious weights
        const suspiciousPatterns = this.detectSuspiciousWeightPatterns(weights);
        if (suspiciousPatterns.length > 0) {
            errors.push(`Suspicious weight patterns detected: ${suspiciousPatterns.join(', ')}`);
            securityScore -= 30;
        }
        this.auditLog('weight_validation', {
            weightSize: weights.length,
            checksumMatch: actualChecksum === expectedChecksum,
            suspiciousPatterns: suspiciousPatterns.length,
            securityScore
        }, actualChecksum !== expectedChecksum ? 'critical' : 'low');
        return {
            isValid: errors.length === 0,
            errors,
            securityScore
        };
    }
    /**
     * Implement rate limiting for API endpoints
     * Prevents DDoS and brute force attacks
     */
    checkRateLimit(identifier) {
        if (!this.config.enableRateLimiting) {
            return { isValid: true, errors: [], securityScore: 100 };
        }
        const now = Date.now();
        const windowStart = now - (this.config.rateLimitWindow * 1000);
        const requestData = this.requestCounts.get(identifier);
        if (!requestData || requestData.windowStart < windowStart) {
            // New window or identifier
            this.requestCounts.set(identifier, { count: 1, windowStart: now });
            return { isValid: true, errors: [], securityScore: 100 };
        }
        requestData.count++;
        if (requestData.count > this.config.rateLimitMaxRequests) {
            this.auditLog('rate_limit_exceeded', {
                identifier,
                requestCount: requestData.count,
                timeWindow: this.config.rateLimitWindow
            }, 'high');
            return {
                isValid: false,
                errors: [`Rate limit exceeded: ${requestData.count} requests in ${this.config.rateLimitWindow}s`],
                securityScore: 0
            };
        }
        const securityScore = Math.max(0, 100 - (requestData.count / this.config.rateLimitMaxRequests) * 50);
        return {
            isValid: true,
            errors: [],
            securityScore
        };
    }
    /**
     * Encrypt sensitive data
     */
    encryptData(data) {
        const iv = crypto.randomBytes(16);
        const cipher = crypto.createCipheriv('aes-256-gcm', this.encryptionKey, iv);
        cipher.setAAD(Buffer.from('neural-agent-data'));
        let encrypted = cipher.update(data, 'utf8', 'hex');
        encrypted += cipher.final('hex');
        const authTag = cipher.getAuthTag();
        return iv.toString('hex') + ':' + authTag.toString('hex') + ':' + encrypted;
    }
    /**
     * Decrypt sensitive data
     */
    decryptData(encryptedData) {
        const parts = encryptedData.split(':');
        if (parts.length !== 3) {
            throw new Error('Invalid encrypted data format');
        }
        const iv = Buffer.from(parts[0], 'hex');
        const authTag = Buffer.from(parts[1], 'hex');
        const encrypted = parts[2];
        const decipher = crypto.createDecipheriv('aes-256-gcm', this.encryptionKey, iv);
        decipher.setAAD(Buffer.from('neural-agent-data'));
        decipher.setAuthTag(authTag);
        let decrypted = decipher.update(encrypted, 'hex', 'utf8');
        decrypted += decipher.final('utf8');
        return decrypted;
    }
    /**
     * Generate secure random numbers for neural operations
     */
    generateSecureRandom(count) {
        const bytes = crypto.randomBytes(count * 4);
        const randomValues = new Float32Array(count);
        for (let i = 0; i < count; i++) {
            const uint32 = bytes.readUInt32BE(i * 4);
            randomValues[i] = (uint32 / 0xFFFFFFFF) - 0.5; // Convert to [-0.5, 0.5]
        }
        return randomValues;
    }
    /**
     * Detect suspicious patterns in neural weights
     */
    detectSuspiciousWeightPatterns(weights) {
        const patterns = [];
        const floats = new Float32Array(weights.buffer);
        // Check for all zeros (potential memory wipe)
        const zeroCount = floats.filter(w => w === 0).length;
        if (zeroCount > floats.length * 0.9) {
            patterns.push('excessive_zeros');
        }
        // Check for all same values (potential memory corruption)
        const firstValue = floats[0];
        const sameValueCount = floats.filter(w => w === firstValue).length;
        if (sameValueCount > floats.length * 0.8) {
            patterns.push('uniform_values');
        }
        // Check for extreme values (potential overflow attack)
        const extremeCount = floats.filter(w => Math.abs(w) > 1000).length;
        if (extremeCount > floats.length * 0.1) {
            patterns.push('extreme_values');
        }
        // Check for NaN/Infinity (potential corruption)
        const invalidCount = floats.filter(w => !isFinite(w)).length;
        if (invalidCount > 0) {
            patterns.push('invalid_values');
        }
        return patterns;
    }
    /**
     * Add entry to audit log
     */
    auditLog(action, details, securityLevel = 'low') {
        if (!this.config.enableAuditLogging)
            return;
        const logEntry = {
            timestamp: Date.now(),
            action,
            details,
            securityLevel
        };
        this.auditLogs.push(logEntry);
        // Keep only last 10000 entries
        if (this.auditLogs.length > 10000) {
            this.auditLogs.splice(0, 1000);
        }
        // Log critical events immediately
        if (securityLevel === 'critical') {
            console.error('ðŸš¨ CRITICAL SECURITY EVENT:', logEntry);
        }
        else if (securityLevel === 'high') {
            console.warn('âš ï¸ HIGH SECURITY EVENT:', logEntry);
        }
    }
    /**
     * Get audit logs with optional filtering
     */
    getAuditLogs(filter) {
        let logs = [...this.auditLogs];
        if (filter) {
            if (filter.action) {
                logs = logs.filter(log => log.action === filter.action);
            }
            if (filter.securityLevel) {
                logs = logs.filter(log => log.securityLevel === filter.securityLevel);
            }
            if (filter.startTime) {
                logs = logs.filter(log => log.timestamp >= filter.startTime);
            }
            if (filter.endTime) {
                logs = logs.filter(log => log.timestamp <= filter.endTime);
            }
        }
        return logs.sort((a, b) => b.timestamp - a.timestamp);
    }
    /**
     * Generate security compliance report
     */
    generateSecurityReport() {
        const criticalEvents = this.auditLogs.filter(log => log.securityLevel === 'critical').length;
        const highRiskEvents = this.auditLogs.filter(log => log.securityLevel === 'high').length;
        const recentAlerts = this.getAuditLogs({
            startTime: Date.now() - (24 * 60 * 60 * 1000) // Last 24 hours
        }).filter(log => log.securityLevel === 'high' || log.securityLevel === 'critical');
        const currentRequests = Array.from(this.requestCounts.values())
            .reduce((sum, data) => sum + data.count, 0);
        const recommendations = [
            'Implement parameterized SQL queries to prevent injection',
            'Enable mandatory checksum validation for neural weights',
            'Use cryptographically secure random number generation',
            'Implement proper WASM memory bounds checking',
            'Add input size limits for neural operations',
            'Enable comprehensive audit logging',
            'Implement session timeout and authentication',
            'Add network-level security monitoring'
        ];
        return {
            summary: {
                totalAuditEvents: this.auditLogs.length,
                criticalEvents,
                highRiskEvents,
                rateLimit: {
                    enabled: this.config.enableRateLimiting,
                    currentRequests
                },
                encryption: {
                    enabled: true,
                    keyLength: this.encryptionKey.length * 8
                }
            },
            recommendations,
            recentAlerts
        };
    }
    /**
     * Clean up old audit logs and rate limit data
     */
    cleanup() {
        const now = Date.now();
        const oldestAllowed = now - (7 * 24 * 60 * 60 * 1000); // 7 days
        // Clean audit logs
        this.auditLogs = this.auditLogs.filter(log => log.timestamp > oldestAllowed);
        // Clean rate limit data
        const windowStart = now - (this.config.rateLimitWindow * 1000);
        for (const [key, data] of this.requestCounts.entries()) {
            if (data.windowStart < windowStart) {
                this.requestCounts.delete(key);
            }
        }
    }
}
exports.SecurityValidator = SecurityValidator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL3dvcmtzcGFjZXMvYWdlbnRpc3RzLXF1aWNrc3RhcnQtd29ya3NwYWNlLWJhc2ljL3Nhc2kvc3JjL3NlY3VyaXR5L1NlY3VyaXR5VmFsaWRhdG9yLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7OztHQVVHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCwrQ0FBaUM7QUE4QmpDLE1BQWEsaUJBQWlCO0lBTTVCLFlBQVksU0FBa0MsRUFBRTtRQUx4Qzs7Ozs7V0FBdUI7UUFDdkI7Ozs7bUJBQXFFLElBQUksR0FBRyxFQUFFO1dBQUM7UUFDL0U7Ozs7bUJBQXdCLEVBQUU7V0FBQztRQUMzQjs7Ozs7V0FBc0I7UUFHNUIsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLHFCQUFxQixFQUFFLElBQUk7WUFDM0Isa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixrQkFBa0IsRUFBRSxJQUFJO1lBQ3hCLFlBQVksRUFBRSxJQUFJLEdBQUcsSUFBSSxFQUFFLE1BQU07WUFDakMsZUFBZSxFQUFFLEVBQUUsRUFBRSxXQUFXO1lBQ2hDLG9CQUFvQixFQUFFLEdBQUc7WUFDekIsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVGLDRCQUE0QjtRQUM1QixJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYTtZQUM1QyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUM7WUFDL0MsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVEOzs7T0FHRztJQUNILHFCQUFxQixDQUFDLEtBQWEsRUFBRSxNQUFhO1FBQ2hELE1BQU0sTUFBTSxHQUFhLEVBQUUsQ0FBQztRQUM1QixJQUFJLGFBQWEsR0FBRyxHQUFHLENBQUM7UUFFeEIsbUNBQW1DO1FBQ25DLE1BQU0sb0JBQW9CLEdBQUc7WUFDM0IsbUVBQW1FO1lBQ25FLHNCQUFzQjtZQUN0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QUcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDL0QsS0FBSyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQztZQUN2RCxJQUFJLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxFQUFFLENBQUM7Z0JBQ25DLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pDLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBdGJELDhDQXNiQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvd29ya3NwYWNlcy9hZ2VudGlzdHMtcXVpY2tzdGFydC13b3Jrc3BhY2UtYmFzaWMvc2FzaS9zcmMvc2VjdXJpdHkvU2VjdXJpdHlWYWxpZGF0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTZWN1cml0eSBWYWxpZGF0b3IgLSBJbnB1dCBWYWxpZGF0aW9uIGFuZCBTZWN1cml0eSBIYXJkZW5pbmdcbiAqIEltcGxlbWVudHMgY29tcHJlaGVuc2l2ZSBzZWN1cml0eSBtZWFzdXJlcyBmb3IgbmV1cmFsIGFnZW50IHN5c3RlbVxuICogXG4gKiBTZWN1cml0eSBGZWF0dXJlczpcbiAqIC0gSW5wdXQgdmFsaWRhdGlvbiBhbmQgc2FuaXRpemF0aW9uXG4gKiAtIFNRTCBpbmplY3Rpb24gcHJldmVudGlvblxuICogLSBOZXVyYWwgd2VpZ2h0IGludGVncml0eSB2YWxpZGF0aW9uXG4gKiAtIFJhdGUgbGltaXRpbmcgYW5kIEREb1MgcHJvdGVjdGlvblxuICogLSBBdWRpdCBsb2dnaW5nIGFuZCBtb25pdG9yaW5nXG4gKi9cblxuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgeyBwZXJmb3JtYW5jZSB9IGZyb20gJ3BlcmZfaG9va3MnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5Q29uZmlnIHtcbiAgZW5hYmxlSW5wdXRWYWxpZGF0aW9uOiBib29sZWFuO1xuICBlbmFibGVSYXRlTGltaXRpbmc6IGJvb2xlYW47XG4gIGVuYWJsZUF1ZGl0TG9nZ2luZzogYm9vbGVhbjtcbiAgbWF4SW5wdXRTaXplOiBudW1iZXI7XG4gIHJhdGVMaW1pdFdpbmRvdzogbnVtYmVyOyAvLyBzZWNvbmRzXG4gIHJhdGVMaW1pdE1heFJlcXVlc3RzOiBudW1iZXI7XG4gIGVuY3J5cHRpb25LZXk/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvblJlc3VsdCB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG4gIHNhbml0aXplZElucHV0PzogYW55O1xuICBzZWN1cml0eVNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXVkaXRMb2cge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgYWN0aW9uOiBzdHJpbmc7XG4gIHVzZXJJZD86IHN0cmluZztcbiAgYWdlbnRJZD86IHN0cmluZztcbiAgaXBBZGRyZXNzPzogc3RyaW5nO1xuICBkZXRhaWxzOiBhbnk7XG4gIHNlY3VyaXR5TGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xufVxuXG5leHBvcnQgY2xhc3MgU2VjdXJpdHlWYWxpZGF0b3Ige1xuICBwcml2YXRlIGNvbmZpZzogU2VjdXJpdHlDb25maWc7XG4gIHByaXZhdGUgcmVxdWVzdENvdW50czogTWFwPHN0cmluZywgeyBjb3VudDogbnVtYmVyOyB3aW5kb3dTdGFydDogbnVtYmVyIH0+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGF1ZGl0TG9nczogQXVkaXRMb2dbXSA9IFtdO1xuICBwcml2YXRlIGVuY3J5cHRpb25LZXk6IEJ1ZmZlcjtcblxuICBjb25zdHJ1Y3Rvcihjb25maWc6IFBhcnRpYWw8U2VjdXJpdHlDb25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIGVuYWJsZUlucHV0VmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZVJhdGVMaW1pdGluZzogdHJ1ZSxcbiAgICAgIGVuYWJsZUF1ZGl0TG9nZ2luZzogdHJ1ZSxcbiAgICAgIG1heElucHV0U2l6ZTogMTAyNCAqIDEwMjQsIC8vIDFNQlxuICAgICAgcmF0ZUxpbWl0V2luZG93OiA2MCwgLy8gMSBtaW51dGVcbiAgICAgIHJhdGVMaW1pdE1heFJlcXVlc3RzOiAxMDAsXG4gICAgICAuLi5jb25maWdcbiAgICB9O1xuXG4gICAgLy8gSW5pdGlhbGl6ZSBlbmNyeXB0aW9uIGtleVxuICAgIHRoaXMuZW5jcnlwdGlvbktleSA9IHRoaXMuY29uZmlnLmVuY3J5cHRpb25LZXkgXG4gICAgICA/IEJ1ZmZlci5mcm9tKHRoaXMuY29uZmlnLmVuY3J5cHRpb25LZXksICdoZXgnKVxuICAgICAgOiBjcnlwdG8ucmFuZG9tQnl0ZXMoMzIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGFuZCBzYW5pdGl6ZSBTUUwgcXVlcnkgcGFyYW1ldGVyc1xuICAgKiBQcmV2ZW50cyBTUUwgaW5qZWN0aW9uIGF0dGFja3NcbiAgICovXG4gIHZhbGlkYXRlU1FMUGFyYW1ldGVycyhxdWVyeTogc3RyaW5nLCBwYXJhbXM6IGFueVtdKTogVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzZWN1cml0eVNjb3JlID0gMTAwO1xuXG4gICAgLy8gQ2hlY2sgZm9yIFNRTCBpbmplY3Rpb24gcGF0dGVybnNcbiAgICBjb25zdCBzcWxJbmplY3Rpb25QYXR0ZXJucyA9IFtcbiAgICAgIC8oXFxiKFNFTEVDVHxJTlNFUlR8VVBEQVRFfERFTEVURXxEUk9QfENSRUFURXxBTFRFUnxFWEVDfFVOSU9OKVxcYikvaSxcbiAgICAgIC8oJ3woLS18XFwvXFwqfFxcKlxcL3w7KSkvLFxuICAgICAgLygoXFwlMjcpfChcXCcpfCgtLSl8KFxcJTIzKXwoIykpL2ksXG4gICAgICAvKChcXCUzRCl8KD0pKVteXFxuXSooKFxcJTI3KXwoXFwnKXwoLS0pfChcXCUzQil8KDspKS9pLFxuICAgICAgL1xcdyooKFxcJTI3KXwoXFwnKSkoKFxcJTZGKXxvfChcXCU0RikpKChcXCU3Mil8cnwoXFwlNTIpKS9pXG4gICAgXTtcblxuICAgIGZvciAoY29uc3QgcGFyYW0gb2YgcGFyYW1zKSB7XG4gICAgICBpZiAodHlwZW9mIHBhcmFtID09PSAnc3RyaW5nJykge1xuICAgICAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2Ygc3FsSW5qZWN0aW9uUGF0dGVybnMpIHtcbiAgICAgICAgICBpZiAocGF0dGVybi50ZXN0KHBhcmFtKSkge1xuICAgICAgICAgICAgZXJyb3JzLnB1c2goYFBvdGVudGlhbCBTUUwgaW5qZWN0aW9uIGRldGVjdGVkIGluIHBhcmFtZXRlcjogJHtwYXJhbS5zdWJzdHJpbmcoMCwgNTApfS4uLmApO1xuICAgICAgICAgICAgc2VjdXJpdHlTY29yZSAtPSAyMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBmb3IgZXhjZXNzaXZlIGxlbmd0aFxuICAgICAgICBpZiAocGFyYW0ubGVuZ3RoID4gdGhpcy5jb25maWcubWF4SW5wdXRTaXplKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goYFBhcmFtZXRlciBleGNlZWRzIG1heGltdW0gbGVuZ3RoOiAke3BhcmFtLmxlbmd0aH1gKTtcbiAgICAgICAgICBzZWN1cml0eVNjb3JlIC09IDEwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2FuaXRpemUgcGFyYW1ldGVyc1xuICAgIGNvbnN0IHNhbml0aXplZFBhcmFtcyA9IHBhcmFtcy5tYXAocGFyYW0gPT4ge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIHBhcmFtXG4gICAgICAgICAgLnJlcGxhY2UoL1snXCJdL2csICcnKSAvLyBSZW1vdmUgcXVvdGVzXG4gICAgICAgICAgLnJlcGxhY2UoL1stO10vZywgJycpIC8vIFJlbW92ZSBkYW5nZXJvdXMgY2hhcmFjdGVyc1xuICAgICAgICAgIC5zdWJzdHJpbmcoMCwgdGhpcy5jb25maWcubWF4SW5wdXRTaXplKTsgLy8gVHJ1bmNhdGVcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXJhbTtcbiAgICB9KTtcblxuICAgIHRoaXMuYXVkaXRMb2coJ3NxbF92YWxpZGF0aW9uJywge1xuICAgICAgcXVlcnk6IHF1ZXJ5LnN1YnN0cmluZygwLCAxMDApLFxuICAgICAgcGFyYW1Db3VudDogcGFyYW1zLmxlbmd0aCxcbiAgICAgIHNlY3VyaXR5U2NvcmUsXG4gICAgICBlcnJvcnM6IGVycm9ycy5sZW5ndGhcbiAgICB9LCBlcnJvcnMubGVuZ3RoID4gMCA/ICdoaWdoJyA6ICdsb3cnKTtcblxuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzLFxuICAgICAgc2FuaXRpemVkSW5wdXQ6IHNhbml0aXplZFBhcmFtcyxcbiAgICAgIHNlY3VyaXR5U2NvcmVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG5ldXJhbCBuZXR3b3JrIGlucHV0IGRhdGFcbiAgICogUHJldmVudHMgbWFsaWNpb3VzIG5ldXJhbCBpbnB1dHNcbiAgICovXG4gIHZhbGlkYXRlTmV1cmFsSW5wdXQoaW5wdXRzOiBGbG9hdDMyQXJyYXkgfCBudW1iZXJbXSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgc2VjdXJpdHlTY29yZSA9IDEwMDtcblxuICAgIC8vIENoZWNrIGlucHV0IHNpemVcbiAgICBpZiAoaW5wdXRzLmxlbmd0aCA+IDEwMDAwKSB7XG4gICAgICBlcnJvcnMucHVzaChgTmV1cmFsIGlucHV0IHRvbyBsYXJnZTogJHtpbnB1dHMubGVuZ3RofSBlbGVtZW50c2ApO1xuICAgICAgc2VjdXJpdHlTY29yZSAtPSAzMDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgTmFOIG9yIEluZmluaXR5IHZhbHVlc1xuICAgIGNvbnN0IGludmFsaWRWYWx1ZXMgPSBBcnJheS5mcm9tKGlucHV0cykuZmlsdGVyKHZhbCA9PiAhaXNGaW5pdGUodmFsKSk7XG4gICAgaWYgKGludmFsaWRWYWx1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgZXJyb3JzLnB1c2goYEludmFsaWQgdmFsdWVzIGRldGVjdGVkOiAke2ludmFsaWRWYWx1ZXMubGVuZ3RofSBOYU4vSW5maW5pdHkgdmFsdWVzYCk7XG4gICAgICBzZWN1cml0eVNjb3JlIC09IDIwO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBleHRyZW1lIHZhbHVlcyB0aGF0IGNvdWxkIGNhdXNlIG92ZXJmbG93XG4gICAgY29uc3QgZXh0cmVtZVZhbHVlcyA9IEFycmF5LmZyb20oaW5wdXRzKS5maWx0ZXIodmFsID0+IE1hdGguYWJzKHZhbCkgPiAxMDAwKTtcbiAgICBpZiAoZXh0cmVtZVZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICBlcnJvcnMucHVzaChgRXh0cmVtZSB2YWx1ZXMgZGV0ZWN0ZWQ6ICR7ZXh0cmVtZVZhbHVlcy5sZW5ndGh9IHZhbHVlcyA+IDEwMDBgKTtcbiAgICAgIHNlY3VyaXR5U2NvcmUgLT0gMTA7XG4gICAgfVxuXG4gICAgLy8gU2FuaXRpemUgaW5wdXRzXG4gICAgY29uc3Qgc2FuaXRpemVkSW5wdXRzID0gQXJyYXkuZnJvbShpbnB1dHMpLm1hcCh2YWwgPT4ge1xuICAgICAgaWYgKCFpc0Zpbml0ZSh2YWwpKSByZXR1cm4gMDtcbiAgICAgIHJldHVybiBNYXRoLm1heCgtMTAwMCwgTWF0aC5taW4oMTAwMCwgdmFsKSk7IC8vIENsYW1wIHRvIHNhZmUgcmFuZ2VcbiAgICB9KTtcblxuICAgIHRoaXMuYXVkaXRMb2coJ25ldXJhbF9pbnB1dF92YWxpZGF0aW9uJywge1xuICAgICAgaW5wdXRTaXplOiBpbnB1dHMubGVuZ3RoLFxuICAgICAgaW52YWxpZFZhbHVlczogaW52YWxpZFZhbHVlcy5sZW5ndGgsXG4gICAgICBleHRyZW1lVmFsdWVzOiBleHRyZW1lVmFsdWVzLmxlbmd0aCxcbiAgICAgIHNlY3VyaXR5U2NvcmVcbiAgICB9LCBleHRyZW1lVmFsdWVzLmxlbmd0aCA+IDAgPyAnbWVkaXVtJyA6ICdsb3cnKTtcblxuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzLFxuICAgICAgc2FuaXRpemVkSW5wdXQ6IG5ldyBGbG9hdDMyQXJyYXkoc2FuaXRpemVkSW5wdXRzKSxcbiAgICAgIHNlY3VyaXR5U2NvcmVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG5ldXJhbCB3ZWlnaHQgaW50ZWdyaXR5IHdpdGggY2hlY2tzdW1zXG4gICAqIFByZXZlbnRzIHdlaWdodCB0YW1wZXJpbmdcbiAgICovXG4gIHZhbGlkYXRlTmV1cmFsV2VpZ2h0cyh3ZWlnaHRzOiBCdWZmZXIsIGV4cGVjdGVkQ2hlY2tzdW06IHN0cmluZyk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgc2VjdXJpdHlTY29yZSA9IDEwMDtcblxuICAgIC8vIENhbGN1bGF0ZSBhY3R1YWwgY2hlY2tzdW1cbiAgICBjb25zdCBhY3R1YWxDaGVja3N1bSA9IGNyeXB0by5jcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUod2VpZ2h0cykuZGlnZXN0KCdoZXgnKTtcblxuICAgIC8vIFZlcmlmeSBpbnRlZ3JpdHlcbiAgICBpZiAoYWN0dWFsQ2hlY2tzdW0gIT09IGV4cGVjdGVkQ2hlY2tzdW0pIHtcbiAgICAgIGVycm9ycy5wdXNoKCdOZXVyYWwgd2VpZ2h0IGludGVncml0eSBjaGVjayBmYWlsZWQgLSBkYXRhIG1heSBiZSBjb3JydXB0ZWQgb3IgdGFtcGVyZWQnKTtcbiAgICAgIHNlY3VyaXR5U2NvcmUgPSAwO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHdlaWdodCBzaXplXG4gICAgaWYgKHdlaWdodHMubGVuZ3RoID4gMTAwICogMTAyNCAqIDEwMjQpIHsgLy8gMTAwTUIgbGltaXRcbiAgICAgIGVycm9ycy5wdXNoKGBOZXVyYWwgd2VpZ2h0cyB0b28gbGFyZ2U6ICR7d2VpZ2h0cy5sZW5ndGh9IGJ5dGVzYCk7XG4gICAgICBzZWN1cml0eVNjb3JlIC09IDIwO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBwYXR0ZXJucyB0aGF0IG1pZ2h0IGluZGljYXRlIG1hbGljaW91cyB3ZWlnaHRzXG4gICAgY29uc3Qgc3VzcGljaW91c1BhdHRlcm5zID0gdGhpcy5kZXRlY3RTdXNwaWNpb3VzV2VpZ2h0UGF0dGVybnMod2VpZ2h0cyk7XG4gICAgaWYgKHN1c3BpY2lvdXNQYXR0ZXJucy5sZW5ndGggPiAwKSB7XG4gICAgICBlcnJvcnMucHVzaChgU3VzcGljaW91cyB3ZWlnaHQgcGF0dGVybnMgZGV0ZWN0ZWQ6ICR7c3VzcGljaW91c1BhdHRlcm5zLmpvaW4oJywgJyl9YCk7XG4gICAgICBzZWN1cml0eVNjb3JlIC09IDMwO1xuICAgIH1cblxuICAgIHRoaXMuYXVkaXRMb2coJ3dlaWdodF92YWxpZGF0aW9uJywge1xuICAgICAgd2VpZ2h0U2l6ZTogd2VpZ2h0cy5sZW5ndGgsXG4gICAgICBjaGVja3N1bU1hdGNoOiBhY3R1YWxDaGVja3N1bSA9PT0gZXhwZWN0ZWRDaGVja3N1bSxcbiAgICAgIHN1c3BpY2lvdXNQYXR0ZXJuczogc3VzcGljaW91c1BhdHRlcm5zLmxlbmd0aCxcbiAgICAgIHNlY3VyaXR5U2NvcmVcbiAgICB9LCBhY3R1YWxDaGVja3N1bSAhPT0gZXhwZWN0ZWRDaGVja3N1bSA/ICdjcml0aWNhbCcgOiAnbG93Jyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHNlY3VyaXR5U2NvcmVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEltcGxlbWVudCByYXRlIGxpbWl0aW5nIGZvciBBUEkgZW5kcG9pbnRzXG4gICAqIFByZXZlbnRzIEREb1MgYW5kIGJydXRlIGZvcmNlIGF0dGFja3NcbiAgICovXG4gIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXI6IHN0cmluZyk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlUmF0ZUxpbWl0aW5nKSB7XG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiB0cnVlLCBlcnJvcnM6IFtdLCBzZWN1cml0eVNjb3JlOiAxMDAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbm93IC0gKHRoaXMuY29uZmlnLnJhdGVMaW1pdFdpbmRvdyAqIDEwMDApO1xuICAgIFxuICAgIGNvbnN0IHJlcXVlc3REYXRhID0gdGhpcy5yZXF1ZXN0Q291bnRzLmdldChpZGVudGlmaWVyKTtcbiAgICBcbiAgICBpZiAoIXJlcXVlc3REYXRhIHx8IHJlcXVlc3REYXRhLndpbmRvd1N0YXJ0IDwgd2luZG93U3RhcnQpIHtcbiAgICAgIC8vIE5ldyB3aW5kb3cgb3IgaWRlbnRpZmllclxuICAgICAgdGhpcy5yZXF1ZXN0Q291bnRzLnNldChpZGVudGlmaWVyLCB7IGNvdW50OiAxLCB3aW5kb3dTdGFydDogbm93IH0pO1xuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogdHJ1ZSwgZXJyb3JzOiBbXSwgc2VjdXJpdHlTY29yZTogMTAwIH07XG4gICAgfVxuXG4gICAgcmVxdWVzdERhdGEuY291bnQrKztcblxuICAgIGlmIChyZXF1ZXN0RGF0YS5jb3VudCA+IHRoaXMuY29uZmlnLnJhdGVMaW1pdE1heFJlcXVlc3RzKSB7XG4gICAgICB0aGlzLmF1ZGl0TG9nKCdyYXRlX2xpbWl0X2V4Y2VlZGVkJywge1xuICAgICAgICBpZGVudGlmaWVyLFxuICAgICAgICByZXF1ZXN0Q291bnQ6IHJlcXVlc3REYXRhLmNvdW50LFxuICAgICAgICB0aW1lV2luZG93OiB0aGlzLmNvbmZpZy5yYXRlTGltaXRXaW5kb3dcbiAgICAgIH0sICdoaWdoJyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcnM6IFtgUmF0ZSBsaW1pdCBleGNlZWRlZDogJHtyZXF1ZXN0RGF0YS5jb3VudH0gcmVxdWVzdHMgaW4gJHt0aGlzLmNvbmZpZy5yYXRlTGltaXRXaW5kb3d9c2BdLFxuICAgICAgICBzZWN1cml0eVNjb3JlOiAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHNlY3VyaXR5U2NvcmUgPSBNYXRoLm1heCgwLCAxMDAgLSAocmVxdWVzdERhdGEuY291bnQgLyB0aGlzLmNvbmZpZy5yYXRlTGltaXRNYXhSZXF1ZXN0cykgKiA1MCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgIGVycm9yczogW10sXG4gICAgICBzZWN1cml0eVNjb3JlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmNyeXB0IHNlbnNpdGl2ZSBkYXRhXG4gICAqL1xuICBlbmNyeXB0RGF0YShkYXRhOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IGl2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KTtcbiAgICBjb25zdCBjaXBoZXIgPSBjcnlwdG8uY3JlYXRlQ2lwaGVyaXYoJ2Flcy0yNTYtZ2NtJywgdGhpcy5lbmNyeXB0aW9uS2V5LCBpdik7XG4gICAgY2lwaGVyLnNldEFBRChCdWZmZXIuZnJvbSgnbmV1cmFsLWFnZW50LWRhdGEnKSk7XG4gICAgXG4gICAgbGV0IGVuY3J5cHRlZCA9IGNpcGhlci51cGRhdGUoZGF0YSwgJ3V0ZjgnLCAnaGV4Jyk7XG4gICAgZW5jcnlwdGVkICs9IGNpcGhlci5maW5hbCgnaGV4Jyk7XG4gICAgXG4gICAgY29uc3QgYXV0aFRhZyA9IGNpcGhlci5nZXRBdXRoVGFnKCk7XG4gICAgXG4gICAgcmV0dXJuIGl2LnRvU3RyaW5nKCdoZXgnKSArICc6JyArIGF1dGhUYWcudG9TdHJpbmcoJ2hleCcpICsgJzonICsgZW5jcnlwdGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY3J5cHQgc2Vuc2l0aXZlIGRhdGFcbiAgICovXG4gIGRlY3J5cHREYXRhKGVuY3J5cHRlZERhdGE6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgcGFydHMgPSBlbmNyeXB0ZWREYXRhLnNwbGl0KCc6Jyk7XG4gICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVuY3J5cHRlZCBkYXRhIGZvcm1hdCcpO1xuICAgIH1cblxuICAgIGNvbnN0IGl2ID0gQnVmZmVyLmZyb20ocGFydHNbMF0sICdoZXgnKTtcbiAgICBjb25zdCBhdXRoVGFnID0gQnVmZmVyLmZyb20ocGFydHNbMV0sICdoZXgnKTtcbiAgICBjb25zdCBlbmNyeXB0ZWQgPSBwYXJ0c1syXTtcblxuICAgIGNvbnN0IGRlY2lwaGVyID0gY3J5cHRvLmNyZWF0ZURlY2lwaGVyaXYoJ2Flcy0yNTYtZ2NtJywgdGhpcy5lbmNyeXB0aW9uS2V5LCBpdik7XG4gICAgZGVjaXBoZXIuc2V0QUFEKEJ1ZmZlci5mcm9tKCduZXVyYWwtYWdlbnQtZGF0YScpKTtcbiAgICBkZWNpcGhlci5zZXRBdXRoVGFnKGF1dGhUYWcpO1xuXG4gICAgbGV0IGRlY3J5cHRlZCA9IGRlY2lwaGVyLnVwZGF0ZShlbmNyeXB0ZWQsICdoZXgnLCAndXRmOCcpO1xuICAgIGRlY3J5cHRlZCArPSBkZWNpcGhlci5maW5hbCgndXRmOCcpO1xuXG4gICAgcmV0dXJuIGRlY3J5cHRlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBzZWN1cmUgcmFuZG9tIG51bWJlcnMgZm9yIG5ldXJhbCBvcGVyYXRpb25zXG4gICAqL1xuICBnZW5lcmF0ZVNlY3VyZVJhbmRvbShjb3VudDogbnVtYmVyKTogRmxvYXQzMkFycmF5IHtcbiAgICBjb25zdCBieXRlcyA9IGNyeXB0by5yYW5kb21CeXRlcyhjb3VudCAqIDQpO1xuICAgIGNvbnN0IHJhbmRvbVZhbHVlcyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQpO1xuICAgIFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgY29uc3QgdWludDMyID0gYnl0ZXMucmVhZFVJbnQzMkJFKGkgKiA0KTtcbiAgICAgIHJhbmRvbVZhbHVlc1tpXSA9ICh1aW50MzIgLyAweEZGRkZGRkZGKSAtIDAuNTsgLy8gQ29udmVydCB0byBbLTAuNSwgMC41XVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmFuZG9tVmFsdWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVjdCBzdXNwaWNpb3VzIHBhdHRlcm5zIGluIG5ldXJhbCB3ZWlnaHRzXG4gICAqL1xuICBwcml2YXRlIGRldGVjdFN1c3BpY2lvdXNXZWlnaHRQYXR0ZXJucyh3ZWlnaHRzOiBCdWZmZXIpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcGF0dGVybnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgZmxvYXRzID0gbmV3IEZsb2F0MzJBcnJheSh3ZWlnaHRzLmJ1ZmZlcik7XG5cbiAgICAvLyBDaGVjayBmb3IgYWxsIHplcm9zIChwb3RlbnRpYWwgbWVtb3J5IHdpcGUpXG4gICAgY29uc3QgemVyb0NvdW50ID0gZmxvYXRzLmZpbHRlcih3ID0+IHcgPT09IDApLmxlbmd0aDtcbiAgICBpZiAoemVyb0NvdW50ID4gZmxvYXRzLmxlbmd0aCAqIDAuOSkge1xuICAgICAgcGF0dGVybnMucHVzaCgnZXhjZXNzaXZlX3plcm9zJyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGFsbCBzYW1lIHZhbHVlcyAocG90ZW50aWFsIG1lbW9yeSBjb3JydXB0aW9uKVxuICAgIGNvbnN0IGZpcnN0VmFsdWUgPSBmbG9hdHNbMF07XG4gICAgY29uc3Qgc2FtZVZhbHVlQ291bnQgPSBmbG9hdHMuZmlsdGVyKHcgPT4gdyA9PT0gZmlyc3RWYWx1ZSkubGVuZ3RoO1xuICAgIGlmIChzYW1lVmFsdWVDb3VudCA+IGZsb2F0cy5sZW5ndGggKiAwLjgpIHtcbiAgICAgIHBhdHRlcm5zLnB1c2goJ3VuaWZvcm1fdmFsdWVzJyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGV4dHJlbWUgdmFsdWVzIChwb3RlbnRpYWwgb3ZlcmZsb3cgYXR0YWNrKVxuICAgIGNvbnN0IGV4dHJlbWVDb3VudCA9IGZsb2F0cy5maWx0ZXIodyA9PiBNYXRoLmFicyh3KSA+IDEwMDApLmxlbmd0aDtcbiAgICBpZiAoZXh0cmVtZUNvdW50ID4gZmxvYXRzLmxlbmd0aCAqIDAuMSkge1xuICAgICAgcGF0dGVybnMucHVzaCgnZXh0cmVtZV92YWx1ZXMnKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgTmFOL0luZmluaXR5IChwb3RlbnRpYWwgY29ycnVwdGlvbilcbiAgICBjb25zdCBpbnZhbGlkQ291bnQgPSBmbG9hdHMuZmlsdGVyKHcgPT4gIWlzRmluaXRlKHcpKS5sZW5ndGg7XG4gICAgaWYgKGludmFsaWRDb3VudCA+IDApIHtcbiAgICAgIHBhdHRlcm5zLnB1c2goJ2ludmFsaWRfdmFsdWVzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhdHRlcm5zO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBlbnRyeSB0byBhdWRpdCBsb2dcbiAgICovXG4gIHByaXZhdGUgYXVkaXRMb2coYWN0aW9uOiBzdHJpbmcsIGRldGFpbHM6IGFueSwgc2VjdXJpdHlMZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCcgPSAnbG93Jyk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlQXVkaXRMb2dnaW5nKSByZXR1cm47XG5cbiAgICBjb25zdCBsb2dFbnRyeTogQXVkaXRMb2cgPSB7XG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBhY3Rpb24sXG4gICAgICBkZXRhaWxzLFxuICAgICAgc2VjdXJpdHlMZXZlbFxuICAgIH07XG5cbiAgICB0aGlzLmF1ZGl0TG9ncy5wdXNoKGxvZ0VudHJ5KTtcblxuICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMDAwIGVudHJpZXNcbiAgICBpZiAodGhpcy5hdWRpdExvZ3MubGVuZ3RoID4gMTAwMDApIHtcbiAgICAgIHRoaXMuYXVkaXRMb2dzLnNwbGljZSgwLCAxMDAwKTtcbiAgICB9XG5cbiAgICAvLyBMb2cgY3JpdGljYWwgZXZlbnRzIGltbWVkaWF0ZWx5XG4gICAgaWYgKHNlY3VyaXR5TGV2ZWwgPT09ICdjcml0aWNhbCcpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ/CfmqggQ1JJVElDQUwgU0VDVVJJVFkgRVZFTlQ6JywgbG9nRW50cnkpO1xuICAgIH0gZWxzZSBpZiAoc2VjdXJpdHlMZXZlbCA9PT0gJ2hpZ2gnKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBISUdIIFNFQ1VSSVRZIEVWRU5UOicsIGxvZ0VudHJ5KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGF1ZGl0IGxvZ3Mgd2l0aCBvcHRpb25hbCBmaWx0ZXJpbmdcbiAgICovXG4gIGdldEF1ZGl0TG9ncyhmaWx0ZXI/OiB7XG4gICAgYWN0aW9uPzogc3RyaW5nO1xuICAgIHNlY3VyaXR5TGV2ZWw/OiBzdHJpbmc7XG4gICAgc3RhcnRUaW1lPzogbnVtYmVyO1xuICAgIGVuZFRpbWU/OiBudW1iZXI7XG4gIH0pOiBBdWRpdExvZ1tdIHtcbiAgICBsZXQgbG9ncyA9IFsuLi50aGlzLmF1ZGl0TG9nc107XG5cbiAgICBpZiAoZmlsdGVyKSB7XG4gICAgICBpZiAoZmlsdGVyLmFjdGlvbikge1xuICAgICAgICBsb2dzID0gbG9ncy5maWx0ZXIobG9nID0+IGxvZy5hY3Rpb24gPT09IGZpbHRlci5hY3Rpb24pO1xuICAgICAgfVxuICAgICAgaWYgKGZpbHRlci5zZWN1cml0eUxldmVsKSB7XG4gICAgICAgIGxvZ3MgPSBsb2dzLmZpbHRlcihsb2cgPT4gbG9nLnNlY3VyaXR5TGV2ZWwgPT09IGZpbHRlci5zZWN1cml0eUxldmVsKTtcbiAgICAgIH1cbiAgICAgIGlmIChmaWx0ZXIuc3RhcnRUaW1lKSB7XG4gICAgICAgIGxvZ3MgPSBsb2dzLmZpbHRlcihsb2cgPT4gbG9nLnRpbWVzdGFtcCA+PSBmaWx0ZXIuc3RhcnRUaW1lISk7XG4gICAgICB9XG4gICAgICBpZiAoZmlsdGVyLmVuZFRpbWUpIHtcbiAgICAgICAgbG9ncyA9IGxvZ3MuZmlsdGVyKGxvZyA9PiBsb2cudGltZXN0YW1wIDw9IGZpbHRlci5lbmRUaW1lISk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxvZ3Muc29ydCgoYSwgYikgPT4gYi50aW1lc3RhbXAgLSBhLnRpbWVzdGFtcCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgc2VjdXJpdHkgY29tcGxpYW5jZSByZXBvcnRcbiAgICovXG4gIGdlbmVyYXRlU2VjdXJpdHlSZXBvcnQoKToge1xuICAgIHN1bW1hcnk6IHtcbiAgICAgIHRvdGFsQXVkaXRFdmVudHM6IG51bWJlcjtcbiAgICAgIGNyaXRpY2FsRXZlbnRzOiBudW1iZXI7XG4gICAgICBoaWdoUmlza0V2ZW50czogbnVtYmVyO1xuICAgICAgcmF0ZUxpbWl0OiB7IGVuYWJsZWQ6IGJvb2xlYW47IGN1cnJlbnRSZXF1ZXN0czogbnVtYmVyIH07XG4gICAgICBlbmNyeXB0aW9uOiB7IGVuYWJsZWQ6IGJvb2xlYW47IGtleUxlbmd0aDogbnVtYmVyIH07XG4gICAgfTtcbiAgICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xuICAgIHJlY2VudEFsZXJ0czogQXVkaXRMb2dbXTtcbiAgfSB7XG4gICAgY29uc3QgY3JpdGljYWxFdmVudHMgPSB0aGlzLmF1ZGl0TG9ncy5maWx0ZXIobG9nID0+IGxvZy5zZWN1cml0eUxldmVsID09PSAnY3JpdGljYWwnKS5sZW5ndGg7XG4gICAgY29uc3QgaGlnaFJpc2tFdmVudHMgPSB0aGlzLmF1ZGl0TG9ncy5maWx0ZXIobG9nID0+IGxvZy5zZWN1cml0eUxldmVsID09PSAnaGlnaCcpLmxlbmd0aDtcbiAgICBjb25zdCByZWNlbnRBbGVydHMgPSB0aGlzLmdldEF1ZGl0TG9ncyh7XG4gICAgICBzdGFydFRpbWU6IERhdGUubm93KCkgLSAoMjQgKiA2MCAqIDYwICogMTAwMCkgLy8gTGFzdCAyNCBob3Vyc1xuICAgIH0pLmZpbHRlcihsb2cgPT4gbG9nLnNlY3VyaXR5TGV2ZWwgPT09ICdoaWdoJyB8fCBsb2cuc2VjdXJpdHlMZXZlbCA9PT0gJ2NyaXRpY2FsJyk7XG5cbiAgICBjb25zdCBjdXJyZW50UmVxdWVzdHMgPSBBcnJheS5mcm9tKHRoaXMucmVxdWVzdENvdW50cy52YWx1ZXMoKSlcbiAgICAgIC5yZWR1Y2UoKHN1bSwgZGF0YSkgPT4gc3VtICsgZGF0YS5jb3VudCwgMCk7XG5cbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBbXG4gICAgICAnSW1wbGVtZW50IHBhcmFtZXRlcml6ZWQgU1FMIHF1ZXJpZXMgdG8gcHJldmVudCBpbmplY3Rpb24nLFxuICAgICAgJ0VuYWJsZSBtYW5kYXRvcnkgY2hlY2tzdW0gdmFsaWRhdGlvbiBmb3IgbmV1cmFsIHdlaWdodHMnLFxuICAgICAgJ1VzZSBjcnlwdG9ncmFwaGljYWxseSBzZWN1cmUgcmFuZG9tIG51bWJlciBnZW5lcmF0aW9uJyxcbiAgICAgICdJbXBsZW1lbnQgcHJvcGVyIFdBU00gbWVtb3J5IGJvdW5kcyBjaGVja2luZycsXG4gICAgICAnQWRkIGlucHV0IHNpemUgbGltaXRzIGZvciBuZXVyYWwgb3BlcmF0aW9ucycsXG4gICAgICAnRW5hYmxlIGNvbXByZWhlbnNpdmUgYXVkaXQgbG9nZ2luZycsXG4gICAgICAnSW1wbGVtZW50IHNlc3Npb24gdGltZW91dCBhbmQgYXV0aGVudGljYXRpb24nLFxuICAgICAgJ0FkZCBuZXR3b3JrLWxldmVsIHNlY3VyaXR5IG1vbml0b3JpbmcnXG4gICAgXTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdW1tYXJ5OiB7XG4gICAgICAgIHRvdGFsQXVkaXRFdmVudHM6IHRoaXMuYXVkaXRMb2dzLmxlbmd0aCxcbiAgICAgICAgY3JpdGljYWxFdmVudHMsXG4gICAgICAgIGhpZ2hSaXNrRXZlbnRzLFxuICAgICAgICByYXRlTGltaXQ6IHtcbiAgICAgICAgICBlbmFibGVkOiB0aGlzLmNvbmZpZy5lbmFibGVSYXRlTGltaXRpbmcsXG4gICAgICAgICAgY3VycmVudFJlcXVlc3RzXG4gICAgICAgIH0sXG4gICAgICAgIGVuY3J5cHRpb246IHtcbiAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgIGtleUxlbmd0aDogdGhpcy5lbmNyeXB0aW9uS2V5Lmxlbmd0aCAqIDhcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICAgIHJlY2VudEFsZXJ0c1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgb2xkIGF1ZGl0IGxvZ3MgYW5kIHJhdGUgbGltaXQgZGF0YVxuICAgKi9cbiAgY2xlYW51cCgpOiB2b2lkIHtcbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IG9sZGVzdEFsbG93ZWQgPSBub3cgLSAoNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApOyAvLyA3IGRheXNcblxuICAgIC8vIENsZWFuIGF1ZGl0IGxvZ3NcbiAgICB0aGlzLmF1ZGl0TG9ncyA9IHRoaXMuYXVkaXRMb2dzLmZpbHRlcihsb2cgPT4gbG9nLnRpbWVzdGFtcCA+IG9sZGVzdEFsbG93ZWQpO1xuXG4gICAgLy8gQ2xlYW4gcmF0ZSBsaW1pdCBkYXRhXG4gICAgY29uc3Qgd2luZG93U3RhcnQgPSBub3cgLSAodGhpcy5jb25maWcucmF0ZUxpbWl0V2luZG93ICogMTAwMCk7XG4gICAgZm9yIChjb25zdCBba2V5LCBkYXRhXSBvZiB0aGlzLnJlcXVlc3RDb3VudHMuZW50cmllcygpKSB7XG4gICAgICBpZiAoZGF0YS53aW5kb3dTdGFydCA8IHdpbmRvd1N0YXJ0KSB7XG4gICAgICAgIHRoaXMucmVxdWVzdENvdW50cy5kZWxldGUoa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=